<head>
  <link
    rel="stylesheet"
    type="text/css"
    href="https://jsxgraph.org/distrib/jsxgraph.css"
  />
  <script
    type="text/javascript"
    src="https://jsxgraph.org/distrib/jsxgraphcore.js"
  ></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.7.0/math.js" type="text/javascript"></script>
</head>

<body>
  <div id="box1" class="jxgbox" style="width: 600px; height: 400px"></div>
  <div style="margin: 5px">
    <p>
      <label for="N">Number of data records: </label>
      <input
        type="range"
        id="N"
        style="border: 0; color: #f6931f; font-weight: bold"
        min="1"
        max="1000000"
        value="10000"
      /><label id="text_N"> 10000</label>
      <br />
      <label for="L">Batch size:</label>
      <input
        type="range"
        id="L"
        style="border: 0; color: #f6931f; font-weight: bold"
        min="1"
        max="10000"
        value="128"
      /><label id="text_L"> 128</label>
      <br />
      <label for="sigma">Noise parameter (sigma):</label>
      <input
        type="range"
        id="sigma"
        style="border: 0; color: #f6931f; font-weight: bold"
        min="4"
        max="500"
        value="10"
      /><label id="text_sigma"> 1</label>
    </p>
  </div>
  <script>
    // Init board.
    var max_epochs = 30;
    var board = JXG.JSXGraph.initBoard("box1", {
      axis: true,
      boundingbox: [0.55, 1.005, max_epochs + 1, 0.83],
      showNavigation: false,
    });

    var xaxis = board.create("axis", [
      [1, 0.85],
      [max_epochs, 0.85],
    ]);
    var yaxis = board.create("axis", [
      [1, 0.8],
      [1, 0.85],
    ]);
    var xlabel = board.create("text", [15, 0.84, "Epochs"]);
    //var ylabel = board.create("text", [0.8, 0.9, "Bayes security"]);

    // Privacy bands.
    var plot_band = function (min_beta, max_beta, color) {
      var p1 = board.create("point", [1, min_beta]);
      var p2 = board.create("point", [max_epochs + 1, min_beta]);
      var p3 = board.create("point", [max_epochs + 1, max_beta]);
      var p4 = board.create("point", [1, max_beta]);
      var pol = board.create("polygon", [p1, p2, p3, p4], {
        hasInnerPoints: true,
        fillColor: color,
        fillOpacity: 0.5,
        withLines: false,
        highlight: false,
      });

      for (i = 0; i < pol.vertices.length - 1; i++) {
        pol.vertices[i].setAttribute({ visible: false });
      }
    };

    plot_band(0.98, 1, "green");
    plot_band(0.9, 0.98, "orange");
    plot_band(0.85, 0.9, "red");

    // Plot function.
    var beta = function (N, L, sigma, T) {
      return 1 - math.erf((L * math.sqrt(T)) / (N * math.sqrt(2) * sigma));
    };
    var N = 10000;
    var L = 128;
    var sigma = 1;

    var plot = board.create(
      "functiongraph",
      [
        function (x) {
          return beta(N, L, sigma, x);
        },
        1,
        max_epochs,
      ],
      { strokeWidth: 3, highlight: false }
    );

    // Update numbers next to the sliders.
    var slider_N = document.getElementById("N");
    var output_N = document.getElementById("text_N");
    var slider_L = document.getElementById("L");
    var output_L = document.getElementById("text_L");
    var slider_sigma = document.getElementById("sigma");
    var output_sigma = document.getElementById("text_sigma");

    slider_N.oninput = function () {
      N = this.value;
      board.update();
      output_N.innerHTML = N;
      // Update range if necessary.
      // TODO: sometimes this doesn't work.
      //if (N < L) {
      //  slider_L.value = N;
      //  L = N;
      //  board.update();
      //  output_L.innerHTML = L;
      //  slider_L.max = L;
      //}
    };

    slider_L.oninput = function () {
      L = this.value;
      board.update();
      output_L.innerHTML = L;
    };

    slider_sigma.oninput = function () {
      sigma = this.value * 0.1;
      board.update();
      output_sigma.innerHTML = sigma;
    };
  </script>
</body>
